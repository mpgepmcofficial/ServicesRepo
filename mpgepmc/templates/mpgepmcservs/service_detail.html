{% extends "mpgepmcservs/base.html" %}

{% block title %}{{ service.name }} Packages{% endblock %}

{% block content %}
<nav class="mb-6 text-sm font-medium text-gray-500" aria-label="Breadcrumb">
    <ol class="flex space-x-2">
        <li><a href="{% url 'index' %}" class="hover:text-primary-blue">Home</a></li>
        <li class="text-gray-400">/</li>
        <li><a href="{% url 'service_class_detail' service.service_class.slug %}" class="hover:text-primary-blue">{{ service.service_class.name }}</a></li>
        <li class="text-gray-400">/</li>
        <li class="text-primary-blue">{{ service.name }}</li>
    </ol>
</nav>

<h1 class="text-4xl font-extrabold text-gray-900 mb-3">{{ service.name }}</h1>
<p class="text-lg text-gray-600 mb-12 max-w-4xl">{{ service.detailed_description|default:service.short_description }}</p>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    {% for package in packages %}
    <div class="bg-white rounded-xl shadow-xl p-8 flex flex-col h-full border-t-8 {% if package.button_type == 'CART' %}border-accent-yellow{% else %}border-gray-200{% endif %}">
        <h2 class="text-2xl font-bold text-gray-900 mb-2">{{ package.package_type }}</h2>
        <div class="text-lg font-medium text-gray-500 mb-4">
            <span class="text-primary-blue font-semibold">{{ package.duration_value }}</span> 
            <span class="text-sm">{% if package.duration_unit != 'ONETIME' %}{{ package.get_duration_unit_display }}{% endif %}</span>
        </div>
        
        <!-- Price Display -->
        <p class="text-4xl font-extrabold text-primary-blue mb-6">
            {{ package.get_display_price }}
            <span class="text-base text-gray-500 font-normal">USD</span>
        </p>

        <p class="text-gray-700 mb-6 flex-grow">{{ package.description }}</p>

        <!-- Features List -->
        <ul class="space-y-3 mb-8 text-gray-700">
            {% for feature in package.features.all %}
            <li class="flex items-start">
                <svg class="h-6 w-6 text-green-500 mr-2 flex-shrink-0" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>
                <span class="text-sm">{{ feature.feature_text }}</span>
            </li>
            {% empty %}
            <li class="text-sm italic text-gray-500">No specific features listed.</li>
            {% endfor %}
        </ul>
        
        <!-- Action Button based on Admin setting -->
        <div class="mt-auto">
            {% if package.button_type == 'CART' %}
            <form method="post" action="{% url 'add_to_cart' package.id %}">
                {% csrf_token %}
                <button type="submit" class="w-full px-6 py-3 border border-transparent text-base font-medium rounded-lg shadow-lg text-gray-900 bg-accent-yellow hover:bg-yellow-400 focus:outline-none focus:ring-4 focus:ring-accent-yellow/50 transition duration-150 uppercase tracking-wider">
                    Add to Cart
                </button>
            </form>
            {% elif package.button_type == 'CONTACT' %}
            <a href="mailto:sales@mpgepmc.com?subject=Inquiry for {{ package.package_type }} - {{ service.name }}" class="w-full block text-center px-6 py-3 border border-primary-blue text-base font-medium rounded-lg shadow-sm text-primary-blue bg-white hover:bg-primary-blue hover:text-white transition duration-150 uppercase tracking-wider">
                Contact Sales
            </a>
            {% else %}
            <button class="w-full px-6 py-3 border border-transparent text-base font-medium rounded-lg shadow-sm text-white bg-primary-blue/70 cursor-not-allowed">
                Price Display Only
            </button>
            {% endif %}
        </div>
    </div>
    {% empty %}
    <div class="col-span-3 text-center py-12 bg-white rounded-xl shadow-lg">
        <p class="text-gray-500 italic">No active packages found for this service.</p>
        <a href="{% url 'service_class_detail' class_slug %}" class="mt-4 text-primary-blue hover:text-blue-700 font-medium inline-block">Go Back to Services</a>
    </div>
    {% endfor %}
</div>
{% endblock %}
